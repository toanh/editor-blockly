<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Check Your Understanding with Blockly</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QE9R7FHTTH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-QE9R7FHTTH');
    </script>  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-192691751-4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-192691751-4');
    </script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T56KV4L');</script>
    <!-- End Google Tag Manager -->    
    <link rel="stylesheet" href="styles.css?t=1">
    <!-- Include the Blockly library from a CDN -->
    <script src="blockly/blockly.min.js"></script>
    <script src="blockly/javascript_compressed.js"> const jsCode = javascript.javascriptGenerator.workspaceToCode(workspace);</script>    
    
    <!-- Main script -->
    <script src="script.js?t=3"></script>
  </head>
  <body>
    
    <div id="blocklySpace">
        <h2>Check Your Understanding with Blockly</h2>
        <!-- Container for the workspace and dialog -->
        <div id="workspaceContainer">
            <!-- Blockly workspace -->
            <div id="blocklyDiv"></div>
            <!-- Custom result dialog with OK button (hidden by default) -->
            <div id="resultDialog">
                <!-- Row container: icon on the left and message on the right -->
                <div class="resultContent">
                <div class="icon"></div>
                <div class="msg"></div>
                </div>
                <button id="okButton">OK</button>
            </div>
        </div>   
        <button id="runButton">â–¶ Run</button>
    </div>   

  </body>
  <script>
    const loadScript = (FILE_URL, async = true, type = "text/javascript") => {
        return new Promise((resolve, reject) => {
            try {
                const scriptEle = document.createElement("script");
                scriptEle.type = type;
                scriptEle.async = async;
                scriptEle.src =FILE_URL;

                scriptEle.addEventListener("load", (ev) => {
                    resolve({ status: true });
                });

                scriptEle.addEventListener("error", (ev) => {
                    reject({
                        status: false,
                        message: `Failed to load the script ${FILE_URL}`
                    });
                });

                document.body.appendChild(scriptEle);
            } catch (error) {
                reject(error);
            }
        });
    };
    const urlParams = new URLSearchParams(window.location.search);
    var activity = urlParams.get('activity');    
    if (activity === null) {
        activity = "winner";
    }
    loadScript(activity + "/blocks.js?t=4")
        .then( data  => {
            console.log("Script loaded successfully", data);
        })
        .catch( err => {
            console.error(err);
        });        
</script>  
</html>
